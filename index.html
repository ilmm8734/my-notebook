<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ú–æ–π –ë–ª–æ–∫–Ω–æ—Ç ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600&display=swap" rel="stylesheet">

<style>
:root{
  --bg: #f6f7fb;
  --card: #ffffff;
  --text: #111827;
  --muted: #6b7280;
  --accent: #ff4d4d;
  --accent-2: #ff6b6b;
  --glass: rgba(255,255,255,0.6);
  --shadow: 0 6px 20px rgba(17,24,39,0.08);
  --radius: 14px;
  --blur: 8px;
}

body.dark{
  --bg: #0b0c0f;
  --card: #0f1114;
  --text: #e6eef6;
  --muted: #9aa3b2;
  --accent: #ff6b6b;
  --accent-2: #ff8484;
  --glass: rgba(255,255,255,0.03);
  --shadow: 0 10px 30px rgba(0,0,0,0.6);
}

*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family:Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text)}

.app { min-height:100vh; display:flex; flex-direction:column; }

.header { display:flex; gap:16px; align-items:center; justify-content:space-between; padding:18px 24px; background:var(--card); box-shadow:var(--shadow) }

.brand { display:flex; align-items:center; gap:12px; }
.logo { width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px; }

.controls { display:flex; gap:10px; align-items:center; }

.btn { cursor:pointer; border:none; border-radius:8px; padding:6px 12px; font-weight:600; }
.btn.primary { background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white }
.btn.small { font-size:13px; padding:4px 8px }

.save-indicator { width:12px; height:12px; border-radius:50%; background:var(--muted); transition:background .3s; }
.save-indicator.saving { background:#22c55e; }

.container { padding:20px; flex:1 }
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:18px; }

.card { position:relative; background:var(--card); border-radius:12px; padding:14px; box-shadow:var(--shadow); cursor:pointer; display:flex; flex-direction:column; gap:10px; min-height:110px; transition:transform .25s, box-shadow .25s }
.card:hover { transform:translateY(-6px); box-shadow:0 14px 40px rgba(0,0,0,0.1) }

.card .meta { display:flex; justify-content:space-between; align-items:center; }
.card h3 { margin:0; font-size:15px; color:var(--accent); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.card p { margin:0; font-size:13px; color:var(--muted); line-height:1.3; overflow:hidden; max-height:3.6em }

.card .actions { position:absolute; top:8px; right:8px; display:flex; gap:6px; opacity:0; transition:opacity .25s }
.card:hover .actions { opacity:1 }
.actions button { background:var(--card); border:1px solid rgba(0,0,0,0.05); border-radius:6px; cursor:pointer; padding:4px; font-size:12px }

.card img { max-width:100%; border-radius:6px; margin-top:6px }

/* Fullscreen */
#fsOverlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); backdrop-filter:blur(6px); z-index:2000; }
.fullscreen-card { background:var(--card); border-radius:14px; padding:18px; width:95%; max-width:900px; box-shadow:0 20px 60px rgba(0,0,0,0.4); display:flex; flex-direction:column; gap:12px; transform:scale(.9); opacity:0; transition:transform .25s, opacity .25s }
.fullscreen-card.enter { transform:scale(1); opacity:1 }

.fs-title { font-size:20px; font-weight:700; color:var(--accent); }
.fs-content { flex:1; min-height:200px; border:1px dashed rgba(0,0,0,0.1); border-radius:10px; padding:10px; overflow:auto }
.fs-content[contenteditable="true"]{ outline:none }

</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="brand"><div class="logo">MB</div><div>–ú–æ–π –ë–ª–æ–∫–Ω–æ—Ç</div></div>
    <div class="controls">
      <button class="btn primary" id="addBtn">Ôºã –ù–æ–≤–∞—è</button>
      <div class="save-indicator" id="saveIndicator"></div>
    </div>
  </header>

  <main class="container">
    <div id="grid" class="grid"></div>
  </main>

  <div id="fsOverlay"></div>
</div>

<script>
let notes = JSON.parse(localStorage.getItem('notes')) || [];
let autosaveTimer=null;
let currentOpenId=null;

function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }

function saveAll(){ localStorage.setItem('notes', JSON.stringify(notes)); }

function renderGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  const sorted=[...notes].sort((a,b)=> (b.pinned?1:0)-(a.pinned?1:0) || b.updatedAt-a.updatedAt);
  for(const n of sorted){
    const card=document.createElement('div');
    card.className='card'; card.dataset.id=n.id;
    card.innerHTML=`<div class="meta"><h3>${n.title||'–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3><span>${n.pinned?'üìå':''}</span></div><p>${n.text.slice(0,120)}</p>${n.image?`<img src="${n.image}">`:''}<div class="actions"><button data-act="edit">‚úè</button><button data-act="pin">üìå</button><button data-act="del">üóë</button></div>`;
    card.querySelector('.actions').addEventListener('click', e=>{
      e.stopPropagation();
      if(e.target.dataset.act==='edit') openFullscreen(n.id,card);
      if(e.target.dataset.act==='pin'){ n.pinned=!n.pinned; saveAll(); renderGrid(); }
      if(e.target.dataset.act==='del'){ notes=notes.filter(x=>x.id!==n.id); saveAll(); renderGrid(); }
    });
    card.addEventListener('click',()=>openFullscreen(n.id,card));
    grid.appendChild(card);
  }
}

function openFullscreen(id, card){
  const n=notes.find(x=>x.id===id); if(!n)return;
  currentOpenId=id;
  const overlay=document.getElementById('fsOverlay');
  overlay.style.display='flex';
  overlay.innerHTML=`<div class="fullscreen-card"><div style="display:flex;justify-content:space-between;align-items:center"><div class="fs-title" contenteditable="true">${n.title}</div><button class="btn small" onclick="closeFs()">‚úñ</button></div><div class="fs-content" id="fsContent" contenteditable="true">${n.text}</div><input type="file" id="imgInput" accept="image/*"><button class="btn small" onclick="saveNote()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>`;
  requestAnimationFrame(()=>overlay.firstChild.classList.add('enter'));
  document.getElementById('fsContent').addEventListener('input',scheduleSave);
  overlay.querySelector('.fs-title').addEventListener('input',scheduleSave);
  document.getElementById('imgInput').addEventListener('change',e=>{
    const file=e.target.files[0];
    if(file){ const r=new FileReader(); r.onload=()=>{n.image=r.result; scheduleSave();}; r.readAsDataURL(file);} 
  });
}

function closeFs(){
  const overlay=document.getElementById('fsOverlay');
  overlay.style.display='none'; overlay.innerHTML='';
  currentOpenId=null;
}

function scheduleSave(){
  clearTimeout(autosaveTimer);
  document.getElementById('saveIndicator').classList.add('saving');
  autosaveTimer=setTimeout(saveNote,800);
}

function saveNote(){
  if(!currentOpenId)return;
  const overlay=document.getElementById('fsOverlay');
  const n=notes.find(x=>x.id===currentOpenId);
  if(!n)return;
  n.title=overlay.querySelector('.fs-title').innerText;
  n.text=overlay.querySelector('#fsContent').innerText;
  n.updatedAt=Date.now();
  saveAll(); renderGrid();
  document.getElementById('saveIndicator').classList.remove('saving');
}

document.getElementById('addBtn').addEventListener('click',()=>{
  notes.push({id:uid(), title:'–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞', text:'', updatedAt:Date.now(), pinned:false, image:null});
  saveAll(); renderGrid();
});

renderGrid();
</script>
</body>
</html>
